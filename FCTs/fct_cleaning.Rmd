---
title: "Documentation of cleaning and processing of the FCTs in MAPS tool"
author: "LuciaSegovia"
creation date: "08/12/2020"
updated version date: "06/11/2020"
version: "0.1"
      output:
  html_document:
    df_print: paged
  pdf_document: 
    latex_engine: xelatex
  word_document: default
---

```{r setup, include=FALSE, warning=FALSE}

knitr::opts_chunk$set(echo = TRUE,warning=FALSE, message=FALSE) 

library(tidyverse)

```

First, we are loading the tidyverse package and the FCT_QA spreadsheet. This spreadsheet is where all the information about each FCT is collated 

Then, we are going to explore all the FCTs saved in excel, which probably will have more than one worksheet. Hence, we need to identify in which of those worksheet is FCT information is located. 

...NOTE:This is something where I need to improve this bit of code

```{r, WAFCT-tagname, echo=FALSE}
```

```{r exploring sheets - loop, echo=FALSE}

#Loading FCT_QA data set

FCT_QA <- readxl::read_excel(here::here('data', 'FCT_QA.xlsx'), sheet = 2)

##TRIAL 1: This loop only works if all statements are = TRUE

sheet <- vector('double',  nrow(FCT_QA))

for(e in 1:nrow(FCT_QA)) {
  x <- paste(paste(FCT_QA[e,6]
                   , FCT_QA[e,2], sep = '_'), 'xlsx', sep = '.')
  
  sheet[[e]] <- readxl::excel_sheets(here::here( 'data',
                                                x)) %>% list()
}

sheet

```

Once we know what it is in each spreadsheet, we can load those sheets of interest. For instance, for West Africa FCT we will use the worksheet 5 ('05_sum_57 (per 100g EP)'). While for Kenya FCT, we need worksheet 4.

Since we want to perform some analysis, we need to standardize the variables. This process is also valuable to analyze the quality of each FCT and to record potential issues or aspects that need to be kept in mind when working with different FCT. Such as, are all same variables calculated in the same way? Are they comparable? Are same variables reported in the same units? Are variables of interest reported? 

Also, it would allow us to run quality check such as, recalculation of variables, sum of proximates (SOP), count of missing values per MN, etc. For more details see 'quality_check.Rmd'.

      SOP =  [WATER + PROTCNT + FAT + CHOAVLDF + FIBFG + ALC + ASH] 
      
## UPDATE:

We have a new set of variables that are going to be standardized across all FCT for MAPS. Hence, they are included in the scripts and updated in the data set.

**NOTE:** We have a spreadsheet with the variables (Standard-MAPS-FCT-variables) and the description of each (i.e., cu_in_mg|	The Copper content of this food item, in milligrams per 100g). We should add an extra-column with the FAO/INFOODS tagname. For two reasons: 1) for compatibility reasons, 2) to be transparent on each variable what could include. 

Column.Name	| Description | FAO_INFOODS.tagname |
-|-|-
cu_in_mg|	The Copper content of this food item, in milligrams per 100g| CU |

#### Standtadization of variables using FAO/INFOODS tagname

As mentioned earlier, the first step is the standardization of variable names. The names used are detailed in the cookbook. In summary, food items names will be code as 'fooditem', food item code will be 'code', food categories or food groups will be 'foodgroup' and food components will be name using the FAO/INFOODS tagnames. Additionally, food groups will be standardized using FoodEx2 classification system and name 'foodgroup_FoodEx2'.

#### Standtadization of values reported

[TO BE DONE]

within this step, we aim to remove different formats that may make data unavailable (i.e. data encapsulated between []) or that some information is missed (i.e. low quality data reported as *italic* in the original spreadsheet). 

We will remove special characters and/or add a new variable to identify those values. 
We have identify a package that can be use to clean very untidy data. The tidyxl package (https://cran.r-project.org/web/packages/tidyxl/vignettes/tidyxl.html)can be used to identify different font, colour and other formatting implemented in the spreadsheet (i.e. excel). 

####Identify potential errors in the data 

After the data is cleaned, we need to run some descriptive and summary test to identify outliers. We can use the min and max values described in the data dictionary as reference. 

Then, we should determine whether those values identified as outliers are a one-off mistake (a decimal error) or are produced by a systematic bias in the data (an error in unit calculation across the fct).

Then, we could try to solve it. If we identify the source of the problem and we can solve the data issue, it is extremely important to 1) document any changes done in the data (i.e. through semantic version), and 2) to inform original data owners.

If we cannot solve the issue, we would still need to flag that data entry and to inform data owners (if relevant).




#### 1) West Africa FCT

**Version log**

V.1.6 updated on 2021/10/13 - Changed phytic acid to phytate, added new food dictionary codes, and amended some existing codes to match the current food dictionary entries. 


Since WAFCT is very recent and it has been done according to FAO/INFOODS tagname, we do not need to standardize much of the variables. Only for code, fooditem, fooditemFR, scientificName, and ref.

UPDATE: Add rename to Energy variables following the standard that it is set below (MAFOODS) 
 +ENERC1 = ENERC...10 = Energy in kcal; 
 +ENERC2 = ENERC...10 = Energy in kJ).
 

There is an issue with values that are between [ ], when converting the variable into numeric those values are coerced as NA. There are two types of data between brackets: 1) Data that has been calculated using a different method or that report a different type of data (i.e. FIBTG vs FIBC). 2) Data that is of low quality. This is the case for minerals. 

To deal with the first type, when different way of reporting same variable (i.e. dietary fibre vs crude fibre). We have desegregated those values into different variables (columns). Then, we can decide which values we want to use (hierarchical decision). It is also good practice to visualize the real number of entries for a particular component. Particularly relevant for:

  -FOL: some of the values are reported as FOLSUM. This tagname is recommended to be discontinued. 

  -PHYYCPP: some values were reported as PHYTCPPD or PHYCPPI.

Then, for minerals that report low quality data between brackets, there are two options here:
 
    1) to eliminate the [ ] and to use the values: Then, we are loosing the reason of putting them between [ ] which is to remark the low quality of that entry.
 
    2) to allow them to be converted in NA: Hence, we are not using low quality information.
 
We do not want to loose information but also we want to use the highest quality available. 

*UPDATE: Bracket issue proposed solution*. We can remove the values from between the brackets and add another column to include a variable of low_quality_MN (yes/no). 

In the version 01, brackets have been removed w/ accounting for the quality (see above). It has been done using a function (no_brackets). To see how it has been developed check (fct_loops.R)

NOTE: Added from another file (FCT_CleaningSOP, created on 8/4/2020) 
NEED CHECKING!

We started with West Africa FCT, the data set is provided in excel with XX sheet. Corresponding to metadata and variables description, FCT (short and long version), FCT statistics, recipe calculation, etc. This FCT follows the FAO guidelines for FCT compilation. 

We need to import the FCT food item list sheet (long version) which is located in the sheet 5. Then, some cleaning and renaming of variables was needed. 

DISCUSSION POINT: Variables names. Are we going to follow FAO standards??

Yes, we will use INFOODS tagnames as standard names

To make the code consistent for all the datasets. I will recode the name of the food items in English as 'fooditem'. If there is another language available, the code will be 'fooditem' and the language code (upper-case) i.e. 'fooditemFR'. This is important because if we use 'name' is a very generic variable name, and it could cause confusion and bugs in our code. 


The next step would be to gather the table back, to separate units from the components and to match the components. Particularly for those of interest for MAPS. 

Additionally, some other general information can be collected from the datasets themselves, such as food categories, number of food items, components included and so forth. 

This part is carried out after the section b, because it is going to be done in parallel with fct cleaning

For extracting component list (names), we need to create a list. Then, we can count (length) the amount of food categories by unlisting. 

NOTE: I am not replacing the food categories for WAFCT because when I pulled manually I only extracted the English names, and I attached the food group number (code).
 
--TILL HERE--

###Food groups

A piece of code is written to remove food groups from the code column and convert it in a new variable. This will be useful for sub-setting by 'foodgroups'. I.e. cereals and other staples. That part will be reconverted when food groups are standardized according to FoodEx2.

UPDATE: We have updated SOP calculation to account for two variables used to report fat: FAT and FATCE. And to account for the two variables used to report fibre (FIBTG and FIBC).

Additionally, ASH in oils in this FCT has value NA, according to FAO/INFOODS Ash can be calculated as sum of minerals:

Ash value (g/100 g EP)> (CA (mg) + FE (mg) + MG (mg)+ P (mg) + K (mg) + NA (mg) + ZN (mg)+ CU (mg) + MN (mg) + CL (mg))/1000

When CL is not reported it can be calculated as (`NA`*2.5). Minerals reported in mcg (i.e. selenium or iodine) are not considered due to the insignificant contribution.

Sum of proximate is included in the original table. There is no need to re-calculated here. It would be re-calculated for quality checks. 

**List of Unavailable foods (from FBS)**:

Local rice
Barley
Rye
Millet (generic)
finger millet
sugar, from unrefined sugar cane
peas, dried, raw
peanuts, unshelled, dried, raw
sunflower seeds, dried
olives, preserved
linseeds
rape seed oil
sesame seed oil
rice bran, oil
cabbages, head, fresh, raw
cabbages, chinese, raw
cocoa powder
tea leaves
peppers, dried, raw
cloves
turmeric roots
wine, white
wine, red
Gin
Deer meat
beef offals
pork fat
Cream (Generic)
water, drinking, bottled
Frog meat
Algae/seaweed
Squid
haddock, smoked
trout, rainbow, fresh, raw
cod, liver oil
cod, body, oil
oysters, fresh, raw
Infant formula --> Not used bc fortified
mustard seed, dried, raw
alcohol, 80perc
`sugar cane juice

###### MAPS Food dictionary

*- Cereals*:

Rice, white, raw (01_037) was assigned to imported rice (23161.01.01), mainly because it is for the whole region hence we assumed that it would be an average for all countries. However, because we are not 100% sure, we have assigned confidence low.  (**TO BE REVIEW**).

###Next steps:

1) Deal with *tr*: there are some values that are coded as *trace* however, when we are converting the values into numbers those are converted to `NA` as it was done wit the []. Hence, we should convert those values coded as `tr` into `0`. 


#### 2) Malawi FCT

**Version log**

V.1.7. updated on 2021/10/25 - Temporary input table from excel (unknown origin), and fixed some dictionary codes (e.g., chicken stew)
V.1.6 updated on 2021/10/12 - Changed phytic acid to phytate & loading table from csv instead of pdf (see new folder MW19).


### Standtadization of values reported

For Malawi dataset all the variables names need to be converted manually because in this FCT component names are not standardized using tagnames or other method. To rename all the component in a standardized way three parameters needs to be taken into account:

  1) component name and description
  2) unit reported
  3) method used for analysis or calculation. 
      I.e. for total nitrogen reported in grams and calculated with Kjeldahl method the tagname is NT

The guidelines used to select the tagnames are 'FAO/INFOODS Guidelines for Checking Food Composition Data prior to the Publication of a User Table/Database Version 1.0, 2012', 'FAO/INFOODS Guidelines Guidelines for Converting Units, Denominators and Expressions Version 1.0, 2012' and the tagnames found in FAO/INFOODS website starting from the most recent (2010 tagnames > 2008 tagnames > 2007 tagnames). 

Decisions for tagnames in Malawi dataset

1) Energy reported as kcal (ENERC1), Calculated as: [Protein (g) x 4kcal] + [Fat (g) x 9kCal] + [Total Carbohydrates(g) x 4kcal]
   Energy reported in kJ (ENERC2), Calculated as: [Protein (g) x 17kJ] + [Fat (g) x 37 kJ] + [Total Carbohydrates(g) x 17kJ]
   
Note: Alcohol has not been captured in this first draft of the MFCT, and thus not
factored into Energy calculations

2) Nitrogen (g) = NT because it is reported in grams and it is mainly calculared by Kjeldahl method

3) Total protein (g) =  PROTCNT. Most of the values were calculated from total, nitrogen, multiplied by Atwater general factor (6.25). In addition, following the advice on FAO/ INFOODS. 'PROCNT' is the appropriate tagname for total protein in most cases.
NOTE: if it is in italic is crude protein. We cannot identify italic with R. We assume that all values are total protein. 

4) Total fat (g) = FAT (fat, total, Unit: g, Synonyms: total lipid). There are a mix of method on how fat has been calculated, including Soxhlet method that tends to underestimate content. However, since we are not currently differentiating between methods we will use the most generic version of the tagname. 

NOTE: Ideally, we should use be able to differentiate between methods. I.e. FAT for mixed solvent extraction and FATCE for continuous extraction (i.e Soxhlet extraction). However, only 'crude fat' is marked with italic, which it is not possible to identify with R. In addition, it is not clear what 'crude fat' means. 

5) Saturated FA (g) = FASAT (fatty acids, total saturated, Unit: g)

6) Mono-unsaturated FA (g) = FAMS (fatty acids, total monounsaturated, Unit: g)

7) Polyunsaturated FA (g) = FAPU (fatty acids, total polyunsaturated, Unit: g)

8) Cholesterol (mg) = CHOLE
CHOLC (cholesterol; determined by chemical method (classical), Unit: mg). We don't have information on how this variable has been obtained and we have chosen the 'classial' version. 
NOTE: This tagname could be updated in the future. UPDATED TO CHOLE

9) Total CHO for UDB = CHOCSM (carbohydrate, total; calculated by summation, Unit: g, Comments: This value is the sum of the, sugars, starches, oligosaccharides, and carbohydrate dietary fibre.). It was the only total CHO by summation. (CHOALVDF + Total Fibre)

10) Carbohydrate, avail. (g) = CHOAVLDF (This value is calculated: 100 g minus total grams of water, protein, fat, alcohol, ash and dietary fibre; or CHOCDF – dietary fibre.)

11) Total sugar (g) = SUGAR (sugars, total, Unit: g, Comments: Sum of free monosaccharides and disaccharides.) From 2010 review tagnames, it is also suggested for sugars when the the method is unknown.

12) Added sugar (g) = SUGAD (added sugar, Unit: g)

13) Total fibre (g) = FIBC (fibre, crude, Unit: g Comments: The crude fibre method of fibre analysis is obsolete.). Other methods were used as well. 
NOTE: When total dietary fibre values were used, they are recorded in italic. Again, it would be worthy to separate this values. In this case, those in italic would be the high quality. 

14) Starch (g) = STARCH (starch, total, Unit: g, Comments: The sum of all polysaccharides yielding glucose after hydrolysis with suitable enzymes; includes amylose, amylopectin, glycogen, and dextrins. The expression is unknown if by weight or in monosaccharide equivalent (2010)).

15) Ash (g) =  ASH (ash, Unit: g, Synonyms: minerals)

16) Ca (mg) = CA (calcium, Unit: mg)

17) Fe (mg) = FE (iron, total, Unit: mg, Comments: Includes both haem and non-haem iron.). We assume total iron since we have no extra information.

18) Mg (mg) = MG (magnesium, Unit: mg). This was the only entry available.

19) P (mg) = P (phosphorus, Unit: mg). This was the only entry available.

20) K (mg) = K (potassium, Unit: mg). This was the only entry available.

21) Na (mg) = NA (sodium, Unit: mg). This was the only entry available. 

22) Zn (mg) = ZN (zinc, Unit: mg). This was the only entry available.

23) Cu (mg) = CU (copper, Unit: mg). This was the only entry available.

24) Mn (mcg) = MN (manganese, Unit: mcg). This is the only entry available.

25) I (mcg) = ID (iodine, Unit: mcg). This is the only entry available.

26) Se (mcg) = SE (selenium, Unit mcg). This is the only entry available.

27) Vitamin A (RAE) (mcg) = VITA_RAE (Total vitamin A activity expressed in mcg retinol activity equivalent, Unit: mcg,  Comment RAE = mcg retinol+ 1/12 mcg beta- carotene + 1/24 mcg other provitamin A carotenoids (or RAE= mcg retinol + 1/12 mcg beta- carotene equivalent)

28) Vitamin A (RE) (mcg) = VITA (vitamin A; calculated by summation of the vitamin A activities of retinol and the active carotenoids, Unit: mcg. Synonyms: retinol equivalents. Comments: Total vitamin A activity = mcg retinol + 1/6 mcg beta-carotene + 1/12 mcg other provitamin A carotenoids.) As per the calculated in MAFOODS ((Retinol, µg/100g EP × 1) + (beta-carotene, µg/100g EP ÷ 6) + (alpha-carotene, µg/ 100g EP ÷ 12) + (beta-cryptoxanthin, µg/100g EP ÷ 12)).

29) Thiamin (mg) = THIA (thiamin, Unit: mg, Synonyms: vitamin B-1; aneurin; thiamine)

30) Riboflavin (mg) = RIBF ( riboflavin, Unit: mg, Synonyms: Vitamin B-2; riboflavine.). This is the only entry available.

31) Niacin (mg) = NIA (niacin, preformed, Unit: mg, Synonyms: nicotinic acid; nicotinamide (These terms are not true synonyms but are often used in food tables to refer to niacin.)). Since, we have no more information, we assume that it is niacin preformed. We could calculate NIAEQ if we have information tryptophan.

32) Vitamin B6 (mg) = VITB6 (vitamin B-6, total; method of determination unknown variable, Unit: mg, Comments: The <VITB6-> tagname should be used if it is not known whether  the vitamin B-6 value was determined by analysis or by calculation.). We use the generic version duet to lack of information on the method on how it has been calculated. 

33) Folic acid (mcg) = FOL (folate, total, Unit: mcg, Synonyms: folacin; folic acid, Comments: Includes both conjugated and free folate, Determined by microbiological assay)). This is the recommended expression. However, more information on how this component has been calculate should be provided.  
Note: Review this content with recently updated info. 

34) Vitamin B12 (mcg) = VITB12 (vitamin B-12, Unit: mcg, Synonyms: cobalamin, Comments: Includes all the active forms of vitamin B-12 in food.). This is the only entry available.

35) Pantothenate (mg) = PANTAC (pantothenic acid, Unit: mg, Synonyms: D-pantothenate; vitamin B-5 (obsolete term, may still appear in some tables)). This is the only entry available.

36) Biotin (mcg) = BIOT (biotin, Unit: mcg, Synonyms: vitamin H). This is the only entry available.

37) Vitamin C (mg) = VITC (vitamin C, Unit: mg, Synonyms: ascorbic acid; ascorbate  (Note that these terms are not true synonyms but are often found in food tables to refer to vitamin C.), Comments: L-ascorbic acid plus L-dehydroascorbic acid.). We used this tagname because most of the method used to calculate vit. C were to calculate both fractions (total vit. C), as HPLC and spectro-photometric method. For the two other items that DCPIP was used, this were raw version of the food items, for this case vit C should be similar. Although it might be worth to check the impact of milling on L-ascorbic acid.

38) Vitamin D (mcg) = VITD (vitamin D; calculated by summation of ergocalciferol and cholecalciferol, Unit: mcg. Synonyms: calciferol, Comments: Ergocalciferol plus cholecalciferol.). Here, we should be using VITD- (vitamin D; method of determination unknown or variable, Comments: The <VITD-> tagname should be used if it is not known whether the vitamin D value was determined by bioassay or by calculation.)

39) Vitamin E (mg) = VITE (vitamin E; calculated by summation of the vitamin E activities of the active tocopherols and tocotrienols; expressed as alpha-tocopherol equivalents Unit: mg.). As with VITD, VITE- should be used as the method is unknown. 

40) Phytic Acid (mg) = PHYT (Phytic acid, unknown or variable method, Unit: mg). This should be PHYT-. It is the most generic version of phytic acid, since we have very little information on how it has been calculated.
Note: information on tagnames for phytates are in the S. Dahdouh et al. 2019. 


Note: Some of the generic tagname should be followed by '-' (dash), however since this character could cause some issues with the code, we have dropped the '-'.


###Identify potential errors in the data

We identified several fooditems with extreme iron (FE) values. The first step is to identify the origin of the data. We identified that most of this values were coming from 2 references papers (ref 10 and ref 15). 

Then, we cross-checked this references with MAFOODS documentation. The ref. 10 is EJ paper. Hence, we checked the data coming from that source. In that paper, data on mineral for a number of food items in Malawi were reported. Also, it is important to mention that the data reported was g/Kg dry weight. We identified that the source of discrepancy between the original data (EJ paper) and MAFOODS reported data is the conversion from dry to wet weight.

Since we are able to track back those values and to correct them, we would be updating the data in MAFOODS for the following variables and food items:

variables: "CA", "CU", "FE", "MG", "SE", "ZN"

fooditems: "MW05_0016", "MW05_0019",  "MW02_0007",  "MW02_0014",  "MW02_0019",  "MW01_0011", "MW01_0016" , "MW01_0037", "MW01_0060",  "MW01_0065", "MW04_0004", "MW04_0011", "MW04_0012", "MW04_0019", "MW04_0020", "MW04_0031", "MW04_0036"

###Standardizing the variables for all MAPS and adding *Genus* codes

We are using the matches that were used for the ihs4-FCT matches. Hence, the next step is to *manually* check and add the confidence to the match and to check for possible inconsistencies. 

We found some inconsistencies mainly due to how matches were done, i.e. duplicated matches, imputation or substitutions 'mice meat' was matched to 'rabbit meat'. We solved most of the duplicated and those that could not been solved were left. That, ended up with items in MAFOODS that are now duplicated (i.e. beef meat, it's beef meat with and without bones).

We have coded the confidence on the labels following the criteria:
  - high: exact match (i.e., onion, raw and onion, raw)
  - medium: same food item but differences in cooking method (i.e. cabbage, raw and cabbage, boiled).
  - low: unspecific food item name used when no better match could be found (i.e. banana (musa) for enjira). 

```{r MAFOODS tagname}

##View FCT structure
#Creating a variable for the names of the data-set 
# it is composed by 2 columns on the FCT_QA dataset
#Column 6 == Year
#Column 2 == Short_name
#Just need to input the number of the row (1-13)

x <- 2


readxl::read_excel(here::here( 'data', 
                              paste(paste(FCT_QA[x,6],
                                          FCT_QA[x,2], sep = '_'), 'xlsx', sep = '.')), sheet = 1) %>% head()


MAFOODS <- readxl::read_excel(here::here( 'data', 
                                         paste(paste(FCT_QA[x,6],
                                                     FCT_QA[x,2], sep = '_'), 'xlsx', sep = '.')), 
                              sheet = 1) %>% mutate(FCT = 'MAFOODS') %>% glimpse()

#Renaming variables with tagnames and converting numeric variables into numeric

FCT_tag <- c('code', 'ref', 'fooditem', 'foodgroup', 'WATER', 'ENERC1', 'ENERC2', 'NT',
             'PROTCNT', 'FAT', 'FASAT', 'FAMS', 'FAPU', 'CHOLE', 'CHOCSM', 'CHOAVLDF',
             'SUGAR', 'SUGAD', 'FIBC', 'STARCH', 'ASH', 'CA', 'FE', 'MG', 'P', 'K', 'NA',
             'ZN', 'CU', 'MN', 'ID', 'SE', 'VITA_RAE', 'VITA', 'THIA', 'RIBF', 'NIA', 'VITB6', 'FOL', 
             'VITB12', 'PANTAC', 'BIOT', 'VITC', 'VITD', 'VITE' ,'PHYT', 'FCT')


MAFOODS <- MAFOODS %>% rename_all( ~ FCT_tag) %>% mutate_at(vars(5:46), funs(as.numeric)) 

#Calculating SOP - Removing ALC and changing FIBTG for FIBC

MAFOODS <- MAFOODS %>%
  mutate(SOP = reduce(select(.,
                             'WATER', 'PROTCNT' ,'FAT', 'CHOAVLDF','FIBC',  'ASH'), `+`))

summary(MAFOODS$SOP)

```

####3) Ethiopia FCT

5) Moisture (%): WATER (Unit: g). It is reported in %. 

9) CHO (inc. fiber) (g): CHOT (total carbohydrates, Unit: g). It is reported including fibre, hence it is 'total CHO'. Because the method is unknown we use the generic CHOT. 

10) Fiber (g): FIBTG (dietary fibre, Unit: g). We are going to assume that it is according to the standards and it is dietary fibre, until further clarification can be obtained. 

16) Beta-carotene Equiv. (mcg): CARTBEQ (beta-caroten equivalent, Unit: mcg). It is not recommended to be listed alone in the FCT. Since we are going to use VITA_RAE or VITA when possible. We can convert this variable to VITA_RAE and VITA by using the following equations. However, retinol information is missing in the ETHFCT.  

Eq.4:  VITA_RAE = mcg retinol + 1/12 mcg ß- carotene equivalent

Eq.5:  VITA = mcg retinol + 1/6 mcg ß- carotene equivalent

20) Tryptophan (mg) : TRP (L-tryptophan, Unit: mg)

21) Ascorbic acid (mg): We are going to assume that it is VitC. 

22) Refuse (%): REFUSE. It might be re-converted to EDIBLE portion to keep consistency

NOTE:Still need to arrange foodgroups

NOTE: When calculating SOP, we do not include fibre because it is already included in CHOT.

####4) Gambia FCT

Within the GMBFCT there are tagnames assigned to each food component

4) Energy...4(kcal): ENERC1 (it should be ENERGYC, as per GMBFCT), this should be re-calculated as CHOAVL but it is not possible since we have no information to convert monosacharides information to weight. Hence, we are going to use it as it is and compared it with the other ENERC.

5) Energy...5 (kJ): ENERC2 (it should be ENERGYC, as per GMBFCT), this needs to be re-calculated as per kJ contribution per macronutrient.

8) Carbo-hydrate (g): CHOAVLM (Carbohydrates availables expresed as monosacharides equivalents, Unit: g). This can not be converted due to lack of information of the carbohydrates composition and can not be compared with available CHO in weight.

9) Fibre (g): FIBTS (total dietary fibre, sum of non-digestible polysaccharides and lignin, Unit: g). More information is needed to know how the estimates are affected by the method. 

10) Phytate (g): PHYTAC. I think it should be PHYPPCD - Phytic acid, based on phytate phosphorus estimated by direct ferric precipitation (Unit: mg) because it used FE precipitation. 

16) Carotene (mcg): CARBEQ (beta-caroten equivalent, Unit: mcg). As in ETHFCT, this should not be listed alone in the FCT.

Ash are not reported, we can see a slightly lower SOP when comparing it with MAFOODS and WAFCT.

```{r GBMFCT tagname }

#Gambia FCT - tagname standardization

#View FCT structure
#Creating a variable for the names of the data-set 
# it is composed by 2 columns on the FCT_QA dataset
#Column 6 == Year
#Column 2 == Short_name
#Just need to input the number of the row (1-13)

x <- 4


readxl::read_excel(here::here( 'data', 
                              paste(paste(FCT_QA[x,6],
                                          FCT_QA[x,2], sep = '_'), 'xlsx', sep = '.')), sheet = 1) %>%
  head()

#Customized saving FCT

GMBFCT <- readxl::read_excel(here::here( 'data', 
                                        paste(paste(FCT_QA[x,6],
                                                    FCT_QA[x,2], sep = '_'), 'xlsx', sep = '.')), 
                             sheet = 1) %>% mutate(FCT = 'GMBFCT') %>% glimpse()


FCT4_tag <- c('foodgroup','code',  'fooditem', 'ENERC1', 'ENERC2',  
              'PROTCNT', 'FAT',  'CHOAVLM', 'FIBTS', 'PHYTAC',
              'WATER', 'CA',  'P', 'FE',  'ZN', 'CARTBEQ', 'VITC',
              'ref', 'FCT')

#Renaming and converting into numeric (needed for binding datasets)

GMBFCT <- GMBFCT %>% rename_all( ~ FCT4_tag) %>% slice(3:527) %>%
  mutate_at(vars(4:17), funs(as.numeric)) 

#Converting into character (needed for binding datasets)

GMBFCT$code <- as.character(GMBFCT$code)

#SOP - changing CHOAVLDF to CHOAVLM, FIBTG to FIBTS, removing ALC, no ASH are included.

GMBFCT <- GMBFCT %>%
  mutate(SOP = reduce(select(.,
                             'WATER', 'PROTCNT' ,'FAT', 'CHOAVLM','FIBTS'), `+`))


```


#### 5) Kenya FCT

**Version log**

V.1.7 updated on 2021/10/25 - Removed duplicated items introduced by biblioID merging and removing the dictionary code for baking powder. 
V.1.6 updated on 2021/10/12 - Changed phytic acid to phytate.
V.1.5 updated on 2021/10/11 - Added new food dictionary codes, and amended some existing codes to match the current food dictionary entries. 
 
#### Importing raw data

The KE18 raw file was an excel file downloaded from the Kenyan Ministry of Health [here](http://www.nutritionhealth.or.ke/wp-content/uploads/Downloads/Kenya%20Food%20Composition%20Tables%20Excel%20files%202018.xlsx). 

It consisted in a number of sheet, the ones used in this document were: sheet 4, which contained the food composition table, and sheet 7, which contained the scientific names and the source of the food components (references). 

The table with the scientific names and bibliography has two duplicated items (code 1025, 4018). 

#### Data cleaning

**Initial checks**

UPDATE: We have counted the number of distinct food items (acc. to unique codes) and there is a mismatch between the number of items reported in the pdf (651) and those find it in the excel file (658).

Within this FCT there are a set of components with tagnames (majority of items not relevants for the project and with high amount of missing values) and other without. To facilitate the standardization of relevant component, we have cut the table in two. 

KENFCT1 - We have review and update tagnames and we have cut the rows until 1242 to be consistent with the number of food items reported. The two extra-rows removed contains information on FOLAC for some food items and an the following statement '**values between [ ] were borrowed from an average of blood from other animals'.

##### Food names and description

There were several typos and other small issues with the names and descriptions that are commonly used to identify food items. When possible, we corrected them in our file, so the output file would be different from the original one. 

**1) Scientific names**

- Eggplant (4017) scientific name is "Solalum melongena", instead of "Solanum melongena".

- The scientific name of Coriander, leaves, fresh, raw (13011) was incorrect, hence we changed to "Coriandrum sativum"

- The scientific name of coconut in 3 entries ("10002", "10003", "10004") were incorrect and we modified to "Cocos nucifera". 

**2) Typos and misspellings**

- There is a typo in "Roti" which was spelled with two "t"s. We re-named to "Roti (Indian Chapati)". 


##### Food components and other variables

Then tagnames were standardized following the standard names as described above and on FCT_QA, some decision point are described below: 

22) Retinol (mcg): RETOL (Retinol, Unit: mcg)

27-28) Folate group: According to the User-guide all four forms were reported (Dietary folate eq., food folate, synthetic folate, total folate). However when exploring the variables only two are present (dietary folate eq., and food folate). FOLAC is reported as comments or food notes for those food items that where fortified. An control check should be implemented for fortified food, since some of the fortified food (FOLDFE ≠ FOLFD) are not always stated in the 'fooditem' (name). FOL was not found in the user-guider nor in the xlsx format. 

We removed [*] that indicates fortification and created a variable FOLAC with YES for those fortified food items. 
UPDATE: We identified a mismatch between the food items identified with (*) as fortified with FOLAC (folic acid) in the pdf version and in the Excel version. According to the pdf there were 18 food item fortified (marked w/ asterisk). So, we were missing one item in the excel version, code(15065). That made us realize that it could be more food items that were not reported to being fortified but actually being fortified. For example, code (01042) was not reported as fortified but FOLDFE = 80mcg/100gFW-EP., while FOLD = 0mcg/100gFW-EP. This is in line w/ what was expressed in the line 523.

The formula to calculate FOLDFE allows to calculate back the fortificant (FOLAC) from the values. Hence, we are adding a FOLAC column check and calculation by instead of searching for [*] by deducting FOLFFE - FOLFD and then dividing it by 1.7. The problem is that because we haven't removed all the brackets and other characters we can't do mathematial inferences as for now, all the columns are considered numeric. For more details on that, see West-Africa notes. 

 Dietary Folate Equivalents (DFE) (mcg/100 g EP) = mcg food folate + (1.7 * mcg folic acid) (Eq.9)

There are values between [] they refer to those food items that folate was not calculated by microbiological array, instead other methods as HPLC were used. 


KENFCT2 - We have incorporated tagnames as per in the dataset (with no modifications)

UPDATES: We added the three main fat fractions ('FASAT', "FAMS","FAPU") from the original FCT dataset. We also added the ref (biblioID) and the scientificName from a different sheet in the FCT.

###### Quality Checks

**Food items to be avoided**

The food item "13002 - Baking powder, dry powder" has quite extreme Ca (and other minerals) values. In addition, it has a very high standard deviation. It was not an analytical value and all the sources of the nutrient values were from abroad (see `r kenfct$biblio_id[kenfct$code == "13002"]`). Furthermore, even being used in small amounts, it was the main driver of Ca consumption in IHS4 and IHS5. Hence, we advise not using this item, and hence removing the dictionary code from it. 


**List of Unavailable foods (from FBS)**:

Refined wheat flour
Barley
Rye
Oats, rolled
Fonio
Olives
Linseed / flaxseed
Cotton seed oil
Palm kernel oil 
Palm oil
Coconut oil
Sesame oil
Rice bran oil
Vegetable, oil
Grapefruit
Tea beverage
Tumeric
Beer
Maize beer
Sorghum beer
Gin
Cream 22120.01 --> cream 22120.02?
Pork lard
Fish body oil
Catfish
Grouper (demersal)
Trout (freshwater)
Haddock, smoked (demersal)
Tinned sardines
Crab
Squid
Oyster
Frog
Algae
Infant formula
Water bottle
Deer meat
Palm kernel
Tea leaves
Jaggery/ sugar from unrefined sugar cane
Alcohol, 80perc

###### MAPS Food dictionary

*- Cereals*:
Millet, bulrush == Pearl millet
https://www.fondazioneslowfood.com/en/ark-of-taste-slow-food/bulrush-millet/

*- Meats*:
Beef meat are all specified w/o bones, except the lean (7002). The edible portion in medium fat (7004) and lean (7002) is the same (0.9), which made us assumed to be w/o bones. However, we gave "low confidence" as no information was provided. 

*- Fats & Oils*:

Fish liver oil (9003) did not specified the fish type, hence we assumed cod liver oil because it is the most common fish liver oil (REF). However, we assigned a "low confidence". 

#### 6) Lesotho FCT

**Version log**
V.1.4 updated on 2021/11/01 - Created a stand-alone script and added dictionary to auto-generate the food groups. 
V.1.3 updated on 2021/10/1 - Replace Trace to zero and removed (*) using new function
V.1.2 updated on 2021/10/12 - Changed phytic acid to phytate.


##### Food components and other variables

Energy is only reported in kJ. Hence, Energy (kcal) (`ENERC1`) was calculated, as well as Sum of proximate (`SOP`). It was not done using thefunction but it could be applied in the future. 

We need to clean the table from missing values that were originated by the format of the table (double-spaces)

NOTE: I need to update the loop for foodgroup variable. None of the loops that I tried worked so far...

There were trace values that were converted to zero, there were (*) values (e.g, in `EDIBLE`) which were removed, although it would good to check the meaning.
In addition, there were ("[]") which were also removed, and would need to be checked as well. 


####7) Mozambique FCT

ONLY PDF


####8) Nigeria FCT

All the variables are already labelled following FAO/INFOODS, hence only minor cleaning is needed. For MN, we need to capitalize them

13) FATCE: Fat values derived from Soxhlet method (Unit: g)

14) CHOCDF: total carbohydrate calculated by difference (Unit: g). This value is calculated: 100 - (weight in grams [water + protein + fat + ash + alcohol] in 100 g of food). In line with previous tagnames, we have changed 

15) FIB: We are going to assume that it is FIBGT, which is the recommended choice by FAO/INFOODS until we have more information. 

There are an issue with some values of protein. 


```{r NGAFCT tagname }

#Nigeria FCT - tagname standardization

#View FCT structure
#Creating a variable for the names of the data-set 
# it is composed by 2 columns on the FCT_QA dataset
#Column 6 == Year
#Column 2 == Short_name
#Just need to input the number of the row (1-13)

x <- 8


readxl::read_excel(here::here(  'data', 
                                paste(paste(FCT_QA[x,6],
                                            FCT_QA[x,2], sep = '_'), 'xlsx', sep = '.')), sheet = 1) %>%
  head()


#Customized saving FCT

NGAFCT <- readxl::read_excel(here::here(  'data', 
                                          paste(paste(FCT_QA[x,6],
                                                      FCT_QA[x,2], sep = '_'), 'xlsx', sep = '.')), 
                             sheet = 1) %>% mutate(FCT = 'NGAFCT')  %>% glimpse()

NGAFCT <- NGAFCT %>% rename(
  ref = 'REFID',
  code = 'Code', 
  foodgroup = 'Category',
  fooditemNGA = 'LocalName',
  fooditem = 'EnglishName',
  scientificName = 'ScientificName',
  fooditemFR = 'FrenchNames',
  ENERC1 = 'ENERC_kcal',
  ENERC2 = 'ENERC_kJ')


#Removing units from variable names

names(NGAFCT) <- sub("_g|_mcg|_mg", "", names(NGAFCT))

NGAFCT <- NGAFCT %>% rename_at(vars(16:25), funs(toupper)) %>%
  rename(VITA_RAE = 'VIT_A_RAE',
         VITB6 = 'VIT_B6',
         FIBGT = 'FIB')


NGAFCT <- NGAFCT %>% mutate_at(vars(9:37), funs(as.numeric)) 


NGAFCT <- NGAFCT %>%
  mutate(SOP = reduce(select(., #It is measuring total CHO, which includes fibre
                             'WATER', 'PROTCNT' ,'FATCE', 'CHOCDF',  'ASH'), `+`))

```
####9) South Africa FCT

ONLY PDF

####10) Tanzania FCT

ONLY PDF

####11) Uganda FCT

There are some variables that we want to keep but we are not going to rename. The fastest approach is to proceed as with KENFCT and cut into two part. Then, to modify separately both and then bind them. 

UGAFCT1 

To include 'ref' as the reference of where the food item is coming from, there are three variables that offer information of the reference source: named fct_source_*. We chose 'fct_souce_descr' because it the one that provided more information from the other three (however, all three remind available in the fct). 

UGAFCT2

2) Dry Matter (g): DM

5) lipid_total_g: FAT - It is stated that it was calculated by by gravimetric methods

7) fibre_g: FIBTG - No information is provided on how fibre was calculated. We are assuming that is total dietary fibre. 
TO BE REVIEWED

21 vit_a_iu: VITA_IU - Vitamin A in IU. This form of expressing VITA is not recommended. In the user-guides is acknowledged and it is adviced not to used, unless no other data is available. They also provided a conversion factor to VIT_RAE for plant and animal food sources. Since, retinol, beta- and alpha- carotene and cryptoxanthin are reported, VITA could be calculated following the proposed equation from FAO/INFOODS.

24) alpha_carot_mcg: CARTA (alpha-carotene, Unit: mcg). 

26) beta_crypt_mcg: CRYPXB (beta-cryptoxanthin, Unti: mcg).

NOTE: Ash is not been reported

```{r UGAFCT tagname }

#Uganda FCT - tagname standardization

#View FCT structure
#Creating a variable for the names of the data-set 
# it is composed by 2 columns on the FCT_QA dataset
#Column 6 == Year
#Column 2 == Short_name
#Just need to input the number of the row (1-13)

x <- 11


readxl::read_excel(here::here(  'data', 
                                paste(paste(FCT_QA[x,6],
                                            FCT_QA[x,2], sep = '_'), 'xlsx', sep = '.')), sheet = 1) %>%
  head()


#Customized saving FCT (1)

UGAFCT1 <- readxl::read_excel(here::here(  'data', 
                                          paste(paste(FCT_QA[x,6],
                                                      FCT_QA[x,2], sep = '_'), 'xlsx', sep = '.')), 
                             sheet = 1) %>% mutate(FCT = 'UGAFCT')  %>% select(1:13) %>% glimpse()

#Renaming some variables

UGAFCT1 <- UGAFCT1 %>% rename(
                      code = 'food_code', 
                      fooditem = 'food_description',
                      ref = 'fct_source_descr',
                      foodgroup = 'food_group')

#Customized saving FCT (2)

UGAFCT2 <- readxl::read_excel(here::here(  'data', 
                                          paste(paste(FCT_QA[x,6],
                                                      FCT_QA[x,2], sep = '_'), 'xlsx', sep = '.')), 
                             sheet = 1)   %>% select(14:39) %>% mutate(FCT = 'UGAFCT') %>% glimpse()

#Variable names acc. tagname

FCT11_tag <- c( 'WATER', 'DM', 'ENERC1', 
              'PROTCNT', 'FAT',  'CHOAVLDF', 'FIBTG',  
              'CA', 'FE',  'ZN', 'VITC', 'THIA', 'RIBF',
              'NIA', 'VITB6', 'FOL', 'FOLAC', 'FOLDF', 'FOLDFE', 
              'VITB12', 'VITA_IU', 'VITA_RAE', 'RETOL', 'CARTA', 'CARTB' , 'CRYPXB', 
              'FCT')

UGAFCT2 <- UGAFCT2 %>% rename_all( ~ FCT11_tag) 


UGAFCT <- bind_cols(UGAFCT1, UGAFCT2)

UGAFCT <- UGAFCT %>%
  mutate(SOP = reduce(select(.,
                             'WATER', 'PROTCNT' ,'FAT', 'CHOAVLDF','FIBTG'), `+`))






summary(UGAFCT$SOP)

```

####12) uFish FCT

This FCT needs only minor renaming since it has all components named using tagnames form FAO/INFOODS. Scientific name are available in the user-guide.

The table reported the ASFIS List of Species for Fishery Statistics Purposes, which refers to column 2 and 3. 

2) ISSCAAP: International Standard Statistical Classification of Aquatic Animals and Plants. Remind unchanged.

3) 3-Alpha: three_alpha - International code for fish.

5) Habitat: referring to fish habitat coded as F - Farmed and W - Wild. Remind unchanged.

6) State of food: food_state - referring to r - raw, c - cooked, p - processed/preserved. We used same code as UGAFCT while keeping it as close as the original uFish. 

8) EDIBLE...8: EDIBLE1 - Following the same rationale as in WAFCT

9) EDIBLE...9: EDIBLE2 - Following the same rationale as in WAFCT

For FAO/INFOODS tagname, I will change all at once for NGAFCT, uFish and uPulses.

```{r uFish tagname }

#uFish FCT - tagname standardization

#View FCT structure
#Creating a variable for the names of the data-set 
# it is composed by 2 columns on the FCT_QA dataset
#Column 6 == Year
#Column 2 == Short_name
#Just need to input the number of the row (1-13)

x <- 12


readxl::read_excel(here::here(  'data', 
                                paste(paste(FCT_QA[x,6],
                                            FCT_QA[x,2], sep = '_'), 'xlsx', sep = '.')), sheet = 4) %>%
  head()

#Customized saving FCT

uFish <- readxl::read_excel(here::here(  'data', 
                                           paste(paste(FCT_QA[x,6],
                                                       FCT_QA[x,2], sep = '_'), 'xlsx', sep = '.')), 
                              sheet = 4) %>% slice(2:516) %>% mutate(FCT = 'uFish')   %>% glimpse()

uFish <- uFish %>% rename(
  code = 'Food Item ID', 
  three_alpha = '3-Alpha',
  fooditem = 'Food name in English',
  food_state = 'State of food',
  ref = 'RefID',
  EDIBLE1 = 'EDIBLE...8',
  EDIBLE2 = 'EDIBLE...9',
  ENERC1 = 'ENERC(kcal)',
  ENERC2 = 'ENERC(kJ)')

names(uFish) <- sub("\\(.*?\\)", "", names(uFish))


uFish <- uFish %>% mutate_at(vars(8:168), funs(as.numeric)) 


uFish <- uFish %>%
  mutate(SOP = reduce(select(.,
                             'WATER', 'PROTCNT' ,'FAT', 'CHOAVLDF','FIBTG',  'ASH'), `+`))

summary(uFish$SOP)

```

####13) uPulses FCT

The structure is very similar to uFish and we will proceed in the same fashion. 

2) 'Country, region': origin - reference of the origin of the food item

4) Processing: food_state coded as r: raw, d: dried, p: processed.

5) Species/Subspecies: scientificName - In the User-guide are refered as the scientific names. Hence, to keep consistency,we have used the same variable names as in WAFCT for the scientific name.

6) Cultivar/Variety/Accession Name: variety - for simplicity we have kept the most common name of the three possible.

FATCE: Fat values derived from Soxhlet method (FATCE)

```{r uPulses tagname }

#uPulses FCT - tagname standardization

#View FCT structure
#Creating a variable for the names of the data-set 
# it is composed by 2 columns on the FCT_QA dataset
#Column 6 == Year
#Column 2 == Short_name
#Just need to input the number of the row (1-13)

x <- 13


readxl::read_excel(here::here(  'data', 
                                paste(paste(FCT_QA[x,6],
                                            FCT_QA[x,2], sep = '_'), 'xlsx', sep = '.')), sheet = 4) %>%
  head()

#Customized saving FCT

uPulses <- readxl::read_excel(here::here(  'data', 
                                         paste(paste(FCT_QA[x,6],
                                                     FCT_QA[x,2], sep = '_'), 'xlsx', sep = '.')), 
                            sheet = 4) %>%  slice(2:177) %>% mutate(FCT = 'uPulses')   %>% glimpse()

uPulses <- uPulses %>% rename(
  code = 'FoodID', 
  origin = 'Country, region',
  fooditem = 'Food name in English',
  food_state = 'Processing',
  scientificName = 'Species/Subspecies',
  variety = 'Cultivar/Variety/Accession Name',
  ref = 'BiblioID',
  ENERC1 = 'ENERC(kcal)',
  ENERC2 = 'ENERC(kJ)')


names(uPulses) <- sub("\\(.*?\\)", "", names(uPulses))

uPulses <- uPulses %>% mutate_at(vars(8:68), funs(as.numeric)) 


uPulses <- uPulses  %>%
  mutate(SOP = reduce(select(.,
                             'WATER', 'PROTCNT' ,'FATCE', 'CHOAVLDF','FIBTG',  'ASH'), `+`))


summary(uPulses$SOP)

```

#### 14) regional fct - Need some work!

**Version log**

V.2.0 updated on 2021/11/01 - Bug fixed: Updated script to the most updated dictionary version.
V.1.9 updated on 2021/10/13 - Changed phytic acid to phytate.

This data is coming from Joy et al. (2014) study. We have reformatted and added the "GENuS" code to each food item, together with the confidence in the matches between the food items that represented and the food items chosen. 

We have prepared a list of updates that could benefit the use of the regional fct for matching with the food balance sheet (or other surveys in sub-Saharan region). Updates to be done for the next release:

###Next steps:

1- There are three missing items in the regional food composition table when compared with all the food balance sheet possible items. The next step will be provide food composition values for those items. 

|item_code| item |
|-|-|
| 2680 |infant food|
| 2558 | rape and mustardseed|
|  2562 | palm kernels|

2- There are multiple matches that were classified as "low confidence", hence those items should be reviewed and updated when possible.

3- The regional fct only reported certain mineral micronutrients, hence we would include other micronurtients of interest to the fct. 

4- The "middle region" food composition table is a exact copy of the "western region" fct, hence when possible and available data for that region should be generated. 

**List of Unavailable foods (from FBS)**:
marine mammals
imported rice
beetroots
sugar cane
fructose, powder
wine rose

#### 15) CoFID fct (UK FCT)

**Version log**

V.1.0 generated on 2021/10/12
V.1.1 updated on 2021/10/13 - Changed "N" to zero using the same function as for "Tr".

#### Data cleaning

##### Food components and other variables

Folate is expressed as: Folate (FOLT) Values are expressed as total folates measured after deconjugation of the polyglutamyl forms, and it was reported in mcg. 

According to the documentation, there are value recorded as "Tr" and as "N". 

- "A trace value for a nutrient is represented by Tr".
- "Where a nutrient is present in significant quantities, but there is no reliable information on the amount, the value is represented by N."

Public Health England, 2021. McCance and Widdowson’s The Composition of Foods Integrated Dataset 2021. User guide. 


**List of Unavailable foods (from FBS)**:
Rye grain
Fonio
Linseed / flaxseed
palm kernel oil
Rice oil / rice bran, oil
Turmeric root
beer, maize grain
gin
cream (Average)
Pork lard / lard
Cod body oil
groupers, white, fresh, raw
crab raw
Frog, raw
Infant formula
Water bottle
Millet (generic)
Sorghum beer
Deer meat
Beef offal, raw
palm kernel
Sugar cane

###### MAPS Food dictionary


**Aquatic products**
Nori (13-340) were matched to Red algae (1594.01) in the food dictionary. Nori are a form of red algae. However it was reported as dried, which is the most common form. But, it should be specified in the food dictionary. 
https://en.wikipedia.org/wiki/Red_algae. 

**Other food**
We matched tea, Chinese, leaves (17-170) with Tea leaves (1620.01). This should be reviewed in the future. 

## MAPS formatting

Final steps are common to all the FCTs, which is renaming the variables according to MAPS standards and descriptions. These are stored in the metadata folder in the file "fct-variable-names.csv". 

A change have been made (2022-10-12), so the variable phyticacid_in_mg would be called phytate_in_mg. 

## Conclusion

1) Energy: Most of the FCT used the ENERC values and conversion factor as established by FAO/INFOODS. Most of the differences were including calculation for kcal and/or kJ. Including ALC or not into the calculation. Mozambique kcal were calculated as kJ and applying a conversion factor (Energy, kJ/4,184). Gambia did not account for fibre and the conversion factor used for CHO was 3.75 (due to the calculation is based on monosaccharide equivalents). In addition, Tanzania used total carbohydrates, hence fibre was included into the CHO fraction (not accounting for differences in fibre conversion factors). Three FCT (eth, nga, uga) did not report the method used to calculate the energy content. This variable will be (re-)calculated following the equations:

Eq.1: ENERC - (kcal/100 g EP) = PROTCNT (g/100 g EP) x 4 + FAT (g/100 g EP) x 9 + CHOAVLDF (g/100 g EP) x 4 + FIBTG (g/100 g EP) x 2 + ALC (g/100 g EP) x 7]

Eq.2: ENERC - (kJ/10- g EP) = PROTCNT (g/100 g EP) x 17 + FAT (g/100 g EP) x 37 + CHOAVLDF (g/100 g EP) x 16 + FIBTG (g/100 g EP) x 8 + ALC (g/100 g EP) x 29]

2) Protein: All FCT that reported used similar approach. It was calculated using total nitrogen (NT) and either a general conversion factor (6.75) or specific conversion factors (XN). If NT information is available for those that used general conversion factor, we could re-calculate using the conversion factors. 

Eq.3: PROTCNT - (g/100 g EP) = nitrogen conversion factor (XN) × total nitrogen (NT) (g/100 g EP)

3) Fat: FAT - is the most common used and it refers to fat calculated using mixed solvent extraction. This was not initially compiled in FCT_QA.  

4) Carbohydrates: Most of the FCT calculated CHO as CHOAVLF (carbohydrates available) as per FAO/INFOODS recommendation with slight variability of the presence or absence of ALC (alcohol). Tanzania reported total carbohydrates (CHOTDF). While, Gambia FCT accounted for available CHO by summation and expressed as monosaccharide equivalents (CHOAVLM). MAFOODS reported total CHO by summation (CHOCSM/CHOTSM?). ETHFCT reported CHOT. According to FAO/INFOOD the preferred reporting is CHOAVL followed by CHOAVLF.  

5) Fibre: Most of the dataset reported total fibre (FIBTG), while MAFOODS reported FIBC (and marked as italic when FIBTG was available) and GMBFCT that reported FIBTS (the sum of non-digestible polysaccharides and lignin). According to the FAO/INFOODS the preferred reporting method is FIBGT followed by FIBTS. While FIBC should be phased out. 

6) Vitamin E: It is reported in some databases as vitamin E and in other it is reported as alpha-tocopherol. We would used vitamin E for both. But, it would be specified in the metadata database. (https://www.kcl.ac.uk/open-global/biomarkers/vitamin/vitamin-e)
